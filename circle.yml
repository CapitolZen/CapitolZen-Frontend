machine:
  node:
    version: 6.1.0
  pre:
    - sudo curl --output /usr/local/bin/phantomjs https://s3.amazonaws.com/circle-downloads/phantomjs-2.1.1

dependencies:
  pre:
    - rm -r ~/$CIRCLE_PROJECT_REPONAME/node_modules || echo 0
    - rm -r /home/ubuntu/.cache/bower || echo 0
    - rm -r ~/$CIRCLE_PROJECT_REPONAME/dist || echo 0
    - yarn global add ember-cli
    #- yarn global add phantomjs@1.9
    - phantomjs --version
    - ember --version
  override:
    - yarn install
    - npm rebuild node-sass

test:
  override:
    - ember build --environment="production"
    - echo "Skipping BAF tests"

deployment:
  production:
    branch: master
    commands:
      - |
        cat >~/.netrc <<EOF
        machine api.heroku.com
          login $HEROKU_EMAIL
          password $HEROKU_TOKEN
        machine git.heroku.com
          login $HEROKU_EMAIL
          password $HEROKU_TOKEN
        EOF
      - chmod 600 ~/.netrc # Heroku cli complains about permissions without this
      - "[[ ! -s \"$(git rev-parse --git-dir)/shallow\" ]] || git fetch --unshallow"
      - git push git@heroku.com:cz-app-frontend.git $CIRCLE_SHA1:refs/heads/master

